# Intent Schemaï¼ˆInnerVoiceï¼‰

## æ¦‚è¦
InnerVoiceã®Intent Busã§ä½¿ç”¨ã•ã‚Œã‚‹Intent/Plan/Actionã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã§ã™ã€‚

## Intent
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œã‚„ã‚ŠãŸã„ã“ã¨ã€ã‚’JSONåŒ–ã—ãŸã‚‚ã®ã€‚

```typescript
interface Intent {
  id: string;
  text: string;           // å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
  type: IntentType;       // "task" | "event" | "message" | "reminder" | "mixed"
  entities: Entity[];     // æŠ½å‡ºã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
  confidence: number;     // 0-1ã®ä¿¡é ¼åº¦
  created_at: string;
}

interface Entity {
  type: "time" | "person" | "location" | "action" | "duration";
  value: string;
  metadata?: Record<string, any>;
}

type IntentType = "task" | "event" | "message" | "reminder" | "mixed";
```

**ä¾‹:**
```json
{
  "id": "int_abc123",
  "text": "æ˜æ—¥æœ7æ™‚ã«30åˆ†ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã—ã¦ã€å¦»ã«é€£çµ¡",
  "type": "mixed",
  "entities": [
    {
      "type": "time",
      "value": "2025-09-19T07:00:00+09:00"
    },
    {
      "type": "duration",
      "value": "30",
      "metadata": { "unit": "minutes" }
    },
    {
      "type": "action",
      "value": "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°"
    },
    {
      "type": "person",
      "value": "å¦»"
    },
    {
      "type": "action",
      "value": "é€£çµ¡"
    }
  ],
  "confidence": 0.92,
  "created_at": "2025-09-19T06:00:00Z"
}
```

## Plan
Intentã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸå®Ÿè¡Œãƒ—ãƒ©ãƒ³ã€‚

```typescript
interface Plan {
  id: string;
  intent_id: string;
  summary: string;        // äººé–“ãŒèª­ã‚ã‚‹è¦ç´„
  actions: Action[];      // å®Ÿè¡Œã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¾¤
  minutes_back: number;   // è¦‹ç©ã‚‚ã‚ŠçŸ­ç¸®æ™‚é–“
  created_at: string;
}

interface Action {
  action: ActionType;     // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥
  [key: string]: any;     // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
}

type ActionType = 
  | "calendar.create"
  | "message.send"
  | "reminder.create"
  | "task.create";
```

**ä¾‹:**
```json
{
  "id": "pl_xyz789",
  "intent_id": "int_abc123",
  "summary": "07:00-07:30 æœãƒ©ãƒ³ + å¦»ã«ãƒ¡ãƒƒã‚» + 06:45ãƒªãƒã‚¤ãƒ³ãƒ‰",
  "actions": [
    {
      "action": "calendar.create",
      "title": "æœãƒ©ãƒ³",
      "start": "2025-09-19T07:00:00+09:00",
      "duration_min": 30,
      "description": "Generated by InnerVoice"
    },
    {
      "action": "message.send",
      "to": "å¦»",
      "text": "7æ™‚ã«èµ°ã£ã¦ãã‚‹ã­"
    },
    {
      "action": "reminder.create",
      "time": "2025-09-19T06:45:00+09:00",
      "note": "ã‚¹ãƒˆãƒ¬ãƒƒãƒæº–å‚™"
    }
  ],
  "minutes_back": 18,
  "created_at": "2025-09-19T06:00:05Z"
}
```

## Execution
ãƒ—ãƒ©ãƒ³ã®å®Ÿè¡Œçµæœã€‚

```typescript
interface Execution {
  id: string;
  plan_id: string;
  status: ExecutionStatus;
  results: ExecutionResult[];
  minutes_back: number;   // å®Ÿéš›ã®çŸ­ç¸®æ™‚é–“
  started_at: string;
  completed_at?: string;
}

type ExecutionStatus = "pending" | "running" | "completed" | "partial" | "failed";

interface ExecutionResult {
  action: ActionType;
  status: "ok" | "error";
  id?: string;            // ä½œæˆã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ID
  error?: string;         // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  latency_ms?: number;
}
```

**ä¾‹:**
```json
{
  "id": "exec_def456",
  "plan_id": "pl_xyz789",
  "status": "completed",
  "results": [
    {
      "action": "calendar.create",
      "status": "ok",
      "id": "evt_111",
      "latency_ms": 342
    },
    {
      "action": "message.send",
      "status": "ok",
      "id": "msg_222",
      "latency_ms": 156
    },
    {
      "action": "reminder.create",
      "status": "ok",
      "id": "rmd_333",
      "latency_ms": 89
    }
  ],
  "minutes_back": 18,
  "started_at": "2025-09-19T06:00:10Z",
  "completed_at": "2025-09-19T06:00:11Z"
}
```

## Validation
ã™ã¹ã¦ã®ã‚¹ã‚­ãƒ¼ãƒã¯[Zod](https://zod.dev/)ã‚’ä½¿ç”¨ã—ã¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã¾ã™ã€‚

å®Ÿè£…: `lib/intent.ts`

## å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
âœ… **v0.2.0-alpha.1**: Intent/Plan/Executionã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã¨DBä¿å­˜æ©Ÿèƒ½
ğŸš§ **v0.3.0**: å®Ÿéš›ã®Connectorçµ±åˆã¨ä¸¦åˆ—å®Ÿè¡Œ
