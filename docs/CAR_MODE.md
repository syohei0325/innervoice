# Car Mode – 車内UXの設計

## 目的
- **読み上げ中心・操作最小**で安全な車内体験を提供
- Screen-off完了率を高め、運転中の注意散漫を防ぐ
- Apple CarPlay / Android Auto ガイドラインに準拠

## 核心原則

### 1. 読み上げ中心
- 提案は**2件まで**読み上げ
- 「AとBがあります。Aは朝ラン20分、Bは夜ストレッチ15分。Aでよろしいですか？」
- ユーザーは「OK」「はい」「A」などで音声確認

### 2. 操作最小
- タップは**最大1回**（緊急キャンセルのみ）
- スクロール禁止
- フォーム入力禁止

### 3. 視覚情報は補助
- 提案タイトルと時間を**大きく**表示
- 文字は**読まなくても理解できる**レベル

## UI設計

### 提案表示（Car Mode）
```
┌─────────────────────┐
│  🏃 朝ラン 20分      │
│  07:10              │
│                     │
│  「Aでよろしいですか？」│
│                     │
│  [Cancel]           │
└─────────────────────┘
```

### 音声フロー
1. **Input**: 「明日朝ランニング30分」
2. **Response**: 「2つの提案があります。Aは朝ラン20分、7時10分開始。Bは夜ストレッチ15分、21時30分開始。Aでよろしいですか？」
3. **User**: 「OK」または「はい」または「A」
4. **Confirm**: 「了解しました。朝ラン20分を予定に追加しました」
5. **Value Receipt**: （音声のみ）「手間を3つ削減、約2分短縮しました」

## 技術仕様

### iOS CarPlay
- **読み上げ**: AVSpeechSynthesizer
- **音声認識**: SFSpeechRecognizer（オフライン優先）
- **UI**: CPTemplate（リスト/アラート）
- **ガイドライン**: 2段階以内のナビゲーション、大きなタップ領域

### Android Auto
- **読み上げ**: TextToSpeech API
- **音声認識**: SpeechRecognizer
- **UI**: MessagingStyle notification + CarAppLibrary
- **ガイドライン**: 運転中のタスク完了時間 < 2秒

### 共通制約
- 提案は**2件まで**
- 読み上げは**30秒以内**
- 確認は音声のみ（「はい」「OK」「A」「B」「キャンセル」）
- Maps URLでナビ起動（Google/Apple分離）

## フォールバック

### 音声認識失敗時
1. 再度読み上げ（最大2回）
2. 3回失敗 → 「後ほど通知でお知らせします」
3. 通知アクションで再確認

### 接続不良時
- ローカルキャッシュの提案を使用
- .ics フォールバック
- SMS で後送

## KPI

### 車内UX
- **Screen-off完了率 ≥ 70%**（車内セッション）
- **音声確認成功率 ≥ 90%**
- **運転中タップ回数 ≤ 1回/セッション**
- **提案読み上げ → 確定 p50 ≤ 10秒**

### 安全性
- **運転中の視線離脱時間 < 2秒**（Apple/Googleガイドライン準拠）
- **誤実行率 < 0.5%**（音声確認の誤認識含む）

## 実装優先度

### Phase 1（0-3ヶ月）
- [x] 音声読み上げ（2提案まで）
- [x] 音声確認（はい/OK/A/B）
- [x] .ics フォールバック

### Phase 2（3-6ヶ月）
- [ ] CarPlay/Android Auto 統合
- [ ] Maps URL委譲（Google/Apple分離）
- [ ] 音声KPI計測

### Phase 3（6-12ヶ月）
- [ ] POIテンプレート対応
- [ ] 駐車場予約連携
- [ ] 通話統合（car.call）

