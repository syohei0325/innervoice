# =========================================
# Yohaku Action Cloud - Phase1 Configuration
# =========================================

# Phase設定（必須）
# phase1 = 0-6m（Exit-first / Webhook+CalendarHold固定 / Private β）
# phase1_5 = 6-12m（Private β拡張 / 追加コネクタ検証）
# phase2 = 12-24m（β / 招待制 / SLA 99.5%）
# phase3 = 24-36m（GA / Enterprise / SLA 99.9%）
YOHAKU_PHASE=phase1

# App Origin（必須）
YOHAKU_APP_ORIGIN=https://yohaku.app
YOHAKU_API_ORIGIN=https://api.yohaku.app
YOHAKU_STATUS_ORIGIN=https://status.yohaku.app

# Database URL（必須）
# Local PostgreSQL example:
DATABASE_URL=postgresql://user:password@localhost:5432/yohaku
# Neon example:
# DATABASE_URL=postgresql://user:password@ep-xxx.us-east-1.aws.neon.tech/yohaku?sslmode=require
# Supabase example:
# DATABASE_URL=postgresql://postgres:password@db.xxx.supabase.co:5432/postgres

# OpenAI API Key（必須 - Plan生成用）
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-openai-api-key-here

# Timezone（必須）
DEFAULT_TZ=Asia/Tokyo

# Region（必須）
YOHAKU_REGION=JP  # JP|US|EU

# =========================================
# Webhook Connector（phase1の主戦場）
# =========================================

# Webhook署名シークレット（必須）
# デプロイ時に生成し、定期的にローテーション
WEBHOOK_SIGNING_SECRET=GENERATE_AT_DEPLOY_AND_ROTATE
WEBHOOK_SIGNING_ALG=HMAC-SHA256

# Webhookリトライポリシー
WEBHOOK_RETRY_MAX_ATTEMPTS=8
WEBHOOK_RETRY_BACKOFF_SECONDS=5,15,45,120,300,600,1200,2400
WEBHOOK_GIVEUP_AFTER_SECONDS=7200

# Webhookリージョンポリシー
WEBHOOK_ALLOWED_REGIONS=JP,US
WEBHOOK_DEFAULT_REGION=JP

# Webhook許可ターゲット
WEBHOOK_CUSTOMER_OWNED_ONLY=true
WEBHOOK_HTTPS_ONLY=true
WEBHOOK_DISALLOW_PUBLIC_INTERNET_WITHOUT_ALLOWLIST=true
WEBHOOK_ALLOWLIST_DOMAINS=

# =========================================
# Calendar Hold（phase1は可逆 + 失敗しても価値が落ちない）
# =========================================

CALENDAR_HOLD_MODE=ics_fallback_first
ICS_TTL_DAYS=14
# CALENDAR_DIRECT_OAUTH=SEALED（phase1は禁止。phase1_5で検討）

# =========================================
# Budget / Rate limit（事故防止：phase1は厳格）
# =========================================

APPROVE_TTL_SECONDS=600
IDEMPOTENCY_TTL_HOURS=24
MAX_ACTIONS_PER_CONFIRM=5
MAX_WEBHOOKS_PER_MINUTE_PER_TENANT=120
MAX_CONFIRM_PER_MINUTE_PER_TENANT=30

# =========================================
# PoEx（Proof-of-Execution）
# =========================================

# サーバー署名用シークレット（必須）
YOHAKU_SERVER_SECRET=your-server-secret-for-poex

# =========================================
# Conformance（ConfirmOS準拠テスト）
# =========================================

CONFIRMOS_VERSION=0.1

# =========================================
# Unit Economics Inputs（phase1：最低限）
# =========================================

AVG_CONFIRM_LATENCY_MS_P50=1200
AVG_CONFIRM_LATENCY_MS_P95=2500
AVG_LLM_COST_PER_CONFIRM_YEN=1.2
AVG_INFRA_COST_PER_CONFIRM_YEN=0.8
TARGET_GROSS_MARGIN_PHASE1=75

# =========================================
# Monetization（phase1：料金・課金単位）
# =========================================

BILLING_CURRENCY=JPY
BILLING_MODE_PHASE1=contract_then_invoice

# =========================================
# Telemetry（Optional）
# =========================================

# PostHog or GA4 write key for event tracking
TELEMETRY_WRITE_KEY=your-posthog-write-key

# =========================================
# Development
# =========================================

NODE_ENV=development

# =========================================
# SEALED（phase1で実行禁止 / 設計・スタブのみ）
# =========================================

# Phone Connector（phase1実行禁止）
# YOHAKU_CALL_PROVIDER=SEALED
# TWILIO_ACCOUNT_SID=SEALED
# TWILIO_AUTH_TOKEN=SEALED
# BLAND_AI_API_KEY=SEALED

# Memory Provider（phase1は最小ログのみ）
# YOHAKU_MEMORY_PROVIDER=SEALED
# SUPERMEMORY_API_KEY=SEALED
# ZEP_API_KEY=SEALED
# MEM0_API_KEY=SEALED

# Proactive/Nudge（phase1実行禁止）
# PROACTIVE_ENABLED=false

# Relationship Graph（phase1実行禁止）
# RELATIONSHIP_GRAPH_ENABLED=false

# OS Deep Integrations（phase1実行禁止）
# OS_INTEGRATIONS_ENABLED=false

# Marketplace（phase3）
# MARKETPLACE_ENABLED=false
